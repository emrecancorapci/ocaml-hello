# OCaml

Blazingly fast introduction to OCaml.

## Install

- To install OCaml official package manager `opam`:

  ```sh
  sudo pacman -S opam
  ```

- Init opam:

  ```sh
  opam init -y
  ```

- Install tools:

  ```sh
  opam install ocaml-lsp-server odoc ocamlformat utop
  ```

  The tools are:

  - **UTop**, a modern interactive toplevel (REPL: Read-Eval-Print Loop)
  
  - **Dune**, a fast and full-featured build system
  
  - **ocaml-lsp-server** implements the Language Server Protocol to enable editor support for OCaml, e.g., in VS Code, Vim, or Emacs.
  
  - **odoc** to generate documentation from OCaml code
  
  - **OCamlFormat** to automatically format OCaml code


## Dune

- build [`-w` for watch]:

  ```sh
  dune build
  ```

- run [`-w` for watch] (`hello` is the name of the module):

  ```sh
  dune exec hello
  ```

- utop (to exit use `CTRL+D` or `#quit;;`):

  ```sh
  dune utop
  ```

## Basic Folder Structure

```
project_name/
├── _build/
│   └── ...
├── bin/
│   ├── dune
│   └── main.ml
├── lib/
│   ├── dune
│   ├── lib_name.ml
│   └── lib_name.mli
├── dune-project
└── project_name.opam
```

- `_build`: Stores the results of the build process. Automatically generated by Dune. Contains compiled artifacts, intermediate files, and executables. ***This folder must not modified directly.***

- `bin`: Contains the executable part of the project. The main entry point of the application will reside here.

  - `main.ml`: Source code of primary executable.

  - `dune`: Each directory managed by Dune has a dune file. This file usually contains the name of the executable and which libraries it depends on.

- `lib`: Contains the core logic of the project. It's designed to contain reusable code that can be linked by other parts of the project.

  - `lib_name.ml`: An example OCaml module implementation file.

  - `lib_name.mli`: Interface for `lib_name.ml`.  It defines what functions, types, and values are exposed to other modules that use this library. 

  - `dune`: Contains the library's name and its public interface.

- `dune-project`: Marks the root of the Dune project and specifies global project settings.

- `project_name.opam`: This is the OPAM (OCaml Package Manager) package definition file. It contains metadata about the project, its dependencies, and how it should be installed.

## Basics

- `bin/main.ml` is application entry.

- To define variable:

  ```ml
  (* lib/en.ml *)

  let v = "Hello, world!"
  ```

- To access this variable from `bin/main.ml`

  ```ml
  (* bin/main.ml *)

  let () = Printf.printf "%s\n" Hello.En.v
  ```

- If there is a `lib/hello.ml` file this won't work. Dune will consider this the whole **Hello** module. So to make En visible this should be created:

  ```ml
  (* lib/hello.ml *)

  module En = En
  ```

## Module Interface

- To declare module interface: 

  ```ml
  (* lib/en.ml *)

  val v : string
  ```

- If we replace `lib/en.ml` with the code below. 

  ```ml
  (* lib/en.ml *)

  let hello = "Hello" (* Unaccessible from outside *)
  let v = hello ^ ", world!"
  ```

- Interface won't list the **hello** variable, so the variable becomes **private**.

  ```ml
  (* bin/main.ml *)

  let () = Printf.printf "%s\n" Hello.En.hello
  (* Error: Unbound value Hello.En.hello *)
  ```

## External Modules

- To install module from a package (sexplib):

  ```sh
  opam install sexplib
  ```

- To add module add package to libraries in `bin/dune` file:

  ```lisp
  (executable
   (public_name hello)
   (name main)
   (libraries hello sexplib))
  ```

- Use the package:

  ```ml
  (* bin/main.ml *)

  (* Read in Sexp from string *)
  let exp1 = Sexplib.Sexp.of_string "(This (is an) (s expression))"

  (* Do something with the Sexp ... *)

  (* Convert back to a string to print *)
  let () = Printf.printf "%s\n" (Sexplib.Sexp.to_string exp1)
  ```